# OMERO Zarr Pixel Buffer

## Requirements

- OMERO 5.6+
- Java 11+

## Artifacts

The latest artifacts built and deployed by GitHub actions can be found on the
[Glencoe Software artifactory](https://artifacts.glencoesoftware.com/)

## Usage

The OMERO Zarr Pixel Buffer follows the principles of a classical OMERO.server
[service extension](https://omero.readthedocs.io/en/stable/developers/Server/ExtendingOmero.html#services).

After putting the `omero-zarr-pixel-buffer.jar` under `lib/server`, the server
must be restarted. To use the ZarrPixelBuffer, an Image or Mask object must be populated with
an [ExternalInfo](https://docs.openmicroscopy.org/omero-blitz/latest/slice2html/omero/model/ExternalInfo.html)
object with the following properties:

-   `entityType` must be set to `com.glencoesoftware.ngff:multiscales`
-   `entityId` must be set to `3`
-   `lsid` must be set to the location of the corresponding Zarr multiscales group:
    - either the absolute path to the multiscales group if the Zarr is on the
      filesystem e.g. `/data/CMU-1.ome.zarr/0`
    - or the URI to the multiscales group if the Zarr is on Amazon S3 defined
      as `s3://s3.<region>.amazonaws.com/<bucket>/<key>` e.g.
      `s3://s3.us-east-1.amazonaws.com/gs-public-zarr-archive/CMU-1.ome.zarr/0`

The Zarr multiscales group must be conformant with the default layout generated by `bioformats2raw` i.e.:

-    the version of the NGFF specification must be 0.4
-    the image and the Zarr multiscales group must have 5 declared dimensions
-    the chunks must be stored in the (t, c, z, y, x) order
-    the resolution levels must be downsampled along the (y, x) axis by a factor 2

For Zarr data hosted on AWS S3, requests must supply
[credentials](https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html).
OMERO Zarr Pixel Buffer looks for credentials in this order:

1.  the credentials profiles file, typically located at ~/.aws/credentials` and shared
    by the AWS CLI
2.  instance profile credentials for EC2 instances configured with a policy
    allowing to assume an IAM role

## Development

Clone the repository:

    git clone https://github.com/glencoesoftware/omero-zarr-pixel-buffer

Run the Gradle build including the tests

    ./gradlew build

## License

The converter is distributed under the terms of the GPL license. Please see [LICENSE.txt](LICENSE.txt)
for further details.
